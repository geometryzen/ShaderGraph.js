(function(){function e(c,a,j){if(c===a)return 0!==c||1/c==1/a;if(null==c||null==a)return c===a;c._chain&&(c=c._wrapped);a._chain&&(a=a._wrapped);if(c.isEqual&&d.isFunction(c.isEqual))return c.isEqual(a);if(a.isEqual&&d.isFunction(a.isEqual))return a.isEqual(c);var s=n.call(c);if(s!=n.call(a))return!1;switch(s){case "[object String]":return c==""+a;case "[object Number]":return c!=+c?a!=+a:0==c?1/c==1/a:c==+a;case "[object Date]":case "[object Boolean]":return+c==+a;case "[object RegExp]":return c.source==
a.source&&c.global==a.global&&c.multiline==a.multiline&&c.ignoreCase==a.ignoreCase}if("object"!=typeof c||"object"!=typeof a)return!1;for(var b=j.length;b--;)if(j[b]==c)return!0;j.push(c);var b=0,f=!0;if("[object Array]"==s){if(b=c.length,f=b==a.length)for(;b--&&(f=b in c==b in a&&e(c[b],a[b],j)););}else{if("constructor"in c!="constructor"in a||c.constructor!=a.constructor)return!1;for(var g in c)if(d.has(c,g)&&(b++,!(f=d.has(a,g)&&e(c[g],a[g],j))))break;if(f){for(g in a)if(d.has(a,g)&&!b--)break;
f=!b}}j.pop();return f}var a=this,b=a._,f={},h=Array.prototype,l=Object.prototype,g=h.slice,k=h.unshift,n=l.toString,H=l.hasOwnProperty,p=h.forEach,y=h.map,z=h.reduce,A=h.reduceRight,B=h.filter,C=h.every,D=h.some,r=h.indexOf,E=h.lastIndexOf,l=Array.isArray,I=Object.keys,t=Function.prototype.bind,d=function(c){return new o(c)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=d),exports._=d):a._=d;d.VERSION="1.3.3";var m=d.each=d.forEach=function(c,
a,j){if(null!=c)if(p&&c.forEach===p)c.forEach(a,j);else if(c.length===+c.length)for(var b=0,e=c.length;b<e&&!(b in c&&a.call(j,c[b],b,c)===f);b++);else for(b in c)if(d.has(c,b)&&a.call(j,c[b],b,c)===f)break};d.map=d.collect=function(c,a,d){var b=[];if(null==c)return b;if(y&&c.map===y)return c.map(a,d);m(c,function(c,f,e){b[b.length]=a.call(d,c,f,e)});c.length===+c.length&&(b.length=c.length);return b};d.reduce=d.foldl=d.inject=function(c,a,j,b){var f=2<arguments.length;null==c&&(c=[]);if(z&&c.reduce===
z)return b&&(a=d.bind(a,b)),f?c.reduce(a,j):c.reduce(a);m(c,function(c,d,e){f?j=a.call(b,j,c,d,e):(j=c,f=!0)});if(!f)throw new TypeError("Reduce of empty array with no initial value");return j};d.reduceRight=d.foldr=function(c,a,j,b){var f=2<arguments.length;null==c&&(c=[]);if(A&&c.reduceRight===A)return b&&(a=d.bind(a,b)),f?c.reduceRight(a,j):c.reduceRight(a);var e=d.toArray(c).reverse();b&&!f&&(a=d.bind(a,b));return f?d.reduce(e,a,j,b):d.reduce(e,a)};d.find=d.detect=function(c,a,d){var b;F(c,function(c,
f,e){if(a.call(d,c,f,e))return b=c,!0});return b};d.filter=d.select=function(c,a,d){var b=[];if(null==c)return b;if(B&&c.filter===B)return c.filter(a,d);m(c,function(c,f,e){a.call(d,c,f,e)&&(b[b.length]=c)});return b};d.reject=function(c,a,d){var b=[];if(null==c)return b;m(c,function(c,f,e){a.call(d,c,f,e)||(b[b.length]=c)});return b};d.every=d.all=function(c,a,d){var b=!0;if(null==c)return b;if(C&&c.every===C)return c.every(a,d);m(c,function(c,e,g){if(!(b=b&&a.call(d,c,e,g)))return f});return!!b};
var F=d.some=d.any=function(c,a,b){a||(a=d.identity);var e=!1;if(null==c)return e;if(D&&c.some===D)return c.some(a,b);m(c,function(c,d,g){if(e||(e=a.call(b,c,d,g)))return f});return!!e};d.include=d.contains=function(c,a){return null==c?!1:r&&c.indexOf===r?-1!=c.indexOf(a):F(c,function(c){return c===a})};d.invoke=function(c,a){var b=g.call(arguments,2);return d.map(c,function(c){return(d.isFunction(a)?a||c:c[a]).apply(c,b)})};d.pluck=function(c,a){return d.map(c,function(c){return c[a]})};d.max=function(c,
a,b){if(!a&&d.isArray(c)&&c[0]===+c[0])return Math.max.apply(Math,c);if(!a&&d.isEmpty(c))return-Infinity;var f={computed:-Infinity};m(c,function(c,d,e){d=a?a.call(b,c,d,e):c;d>=f.computed&&(f={value:c,computed:d})});return f.value};d.min=function(c,a,b){if(!a&&d.isArray(c)&&c[0]===+c[0])return Math.min.apply(Math,c);if(!a&&d.isEmpty(c))return Infinity;var f={computed:Infinity};m(c,function(c,d,e){d=a?a.call(b,c,d,e):c;d<f.computed&&(f={value:c,computed:d})});return f.value};d.shuffle=function(c){var a=
[],d;m(c,function(c,b){d=Math.floor(Math.random()*(b+1));a[b]=a[d];a[d]=c});return a};d.sortBy=function(c,a,b){var f=d.isFunction(a)?a:function(c){return c[a]};return d.pluck(d.map(c,function(c,a,d){return{value:c,criteria:f.call(b,c,a,d)}}).sort(function(c,a){var d=c.criteria,b=a.criteria;return void 0===d?1:void 0===b?-1:d<b?-1:d>b?1:0}),"value")};d.groupBy=function(c,a){var b={},f=d.isFunction(a)?a:function(c){return c[a]};m(c,function(c,a){var d=f(c,a);(b[d]||(b[d]=[])).push(c)});return b};d.sortedIndex=
function(c,a,b){b||(b=d.identity);for(var f=0,e=c.length;f<e;){var g=f+e>>1;b(c[g])<b(a)?f=g+1:e=g}return f};d.toArray=function(c){return!c?[]:d.isArray(c)||d.isArguments(c)?g.call(c):c.toArray&&d.isFunction(c.toArray)?c.toArray():d.values(c)};d.size=function(c){return d.isArray(c)?c.length:d.keys(c).length};d.first=d.head=d.take=function(c,a,d){return null!=a&&!d?g.call(c,0,a):c[0]};d.initial=function(c,a,d){return g.call(c,0,c.length-(null==a||d?1:a))};d.last=function(c,a,d){return null!=a&&!d?
g.call(c,Math.max(c.length-a,0)):c[c.length-1]};d.rest=d.tail=function(c,a,d){return g.call(c,null==a||d?1:a)};d.compact=function(c){return d.filter(c,function(c){return!!c})};d.flatten=function(c,a){return d.reduce(c,function(c,b){if(d.isArray(b))return c.concat(a?b:d.flatten(b));c[c.length]=b;return c},[])};d.without=function(c){return d.difference(c,g.call(arguments,1))};d.uniq=d.unique=function(c,a,b){var b=b?d.map(c,b):c,f=[];3>c.length&&(a=!0);d.reduce(b,function(b,j,e){if(a?d.last(b)!==j||
!b.length:!d.include(b,j))b.push(j),f.push(c[e]);return b},[]);return f};d.union=function(){return d.uniq(d.flatten(arguments,!0))};d.intersection=d.intersect=function(c){var a=g.call(arguments,1);return d.filter(d.uniq(c),function(c){return d.every(a,function(a){return 0<=d.indexOf(a,c)})})};d.difference=function(c){var a=d.flatten(g.call(arguments,1),!0);return d.filter(c,function(c){return!d.include(a,c)})};d.zip=function(){for(var c=g.call(arguments),a=d.max(d.pluck(c,"length")),b=Array(a),f=
0;f<a;f++)b[f]=d.pluck(c,""+f);return b};d.indexOf=function(c,a,b){if(null==c)return-1;var f;if(b)return b=d.sortedIndex(c,a),c[b]===a?b:-1;if(r&&c.indexOf===r)return c.indexOf(a);b=0;for(f=c.length;b<f;b++)if(b in c&&c[b]===a)return b;return-1};d.lastIndexOf=function(c,a){if(null==c)return-1;if(E&&c.lastIndexOf===E)return c.lastIndexOf(a);for(var d=c.length;d--;)if(d in c&&c[d]===a)return d;return-1};d.range=function(c,a,d){1>=arguments.length&&(a=c||0,c=0);for(var d=arguments[2]||1,b=Math.max(Math.ceil((a-
c)/d),0),f=0,e=Array(b);f<b;)e[f++]=c,c+=d;return e};var G=function(){};d.bind=function(c,a){var b,f;if(c.bind===t&&t)return t.apply(c,g.call(arguments,1));if(!d.isFunction(c))throw new TypeError;f=g.call(arguments,2);return b=function(){if(!(this instanceof b))return c.apply(a,f.concat(g.call(arguments)));G.prototype=c.prototype;var d=new G,e=c.apply(d,f.concat(g.call(arguments)));return Object(e)===e?e:d}};d.bindAll=function(c){var a=g.call(arguments,1);0==a.length&&(a=d.functions(c));m(a,function(a){c[a]=
d.bind(c[a],c)});return c};d.memoize=function(c,a){var b={};a||(a=d.identity);return function(){var f=a.apply(this,arguments);return d.has(b,f)?b[f]:b[f]=c.apply(this,arguments)}};d.delay=function(c,a){var d=g.call(arguments,2);return setTimeout(function(){return c.apply(null,d)},a)};d.defer=function(c){return d.delay.apply(d,[c,1].concat(g.call(arguments,1)))};d.throttle=function(c,a){var b,f,e,g,h,l,p=d.debounce(function(){h=g=!1},a);return function(){b=this;f=arguments;e||(e=setTimeout(function(){e=
null;h&&c.apply(b,f);p()},a));g?h=!0:l=c.apply(b,f);p();g=!0;return l}};d.debounce=function(c,a,d){var b;return function(){var f=this,e=arguments;d&&!b&&c.apply(f,e);clearTimeout(b);b=setTimeout(function(){b=null;d||c.apply(f,e)},a)}};d.once=function(c){var a=!1,d;return function(){if(a)return d;a=!0;return d=c.apply(this,arguments)}};d.wrap=function(c,a){return function(){var d=[c].concat(g.call(arguments,0));return a.apply(this,d)}};d.compose=function(){var c=arguments;return function(){for(var a=
arguments,d=c.length-1;0<=d;d--)a=[c[d].apply(this,a)];return a[0]}};d.after=function(c,a){return 0>=c?a():function(){if(1>--c)return a.apply(this,arguments)}};d.keys=I||function(c){if(c!==Object(c))throw new TypeError("Invalid object");var a=[],b;for(b in c)d.has(c,b)&&(a[a.length]=b);return a};d.values=function(a){return d.map(a,d.identity)};d.functions=d.methods=function(a){var b=[],f;for(f in a)d.isFunction(a[f])&&b.push(f);return b.sort()};d.extend=function(a){m(g.call(arguments,1),function(d){for(var b in d)a[b]=
d[b]});return a};d.pick=function(a){var b={};m(d.flatten(g.call(arguments,1)),function(d){d in a&&(b[d]=a[d])});return b};d.defaults=function(a){m(g.call(arguments,1),function(d){for(var b in d)null==a[b]&&(a[b]=d[b])});return a};d.clone=function(a){return!d.isObject(a)?a:d.isArray(a)?a.slice():d.extend({},a)};d.tap=function(a,d){d(a);return a};d.isEqual=function(a,d){return e(a,d,[])};d.isEmpty=function(a){if(null==a)return!0;if(d.isArray(a)||d.isString(a))return 0===a.length;for(var b in a)if(d.has(a,
b))return!1;return!0};d.isElement=function(a){return!!(a&&1==a.nodeType)};d.isArray=l||function(a){return"[object Array]"==n.call(a)};d.isObject=function(a){return a===Object(a)};d.isArguments=function(a){return"[object Arguments]"==n.call(a)};d.isArguments(arguments)||(d.isArguments=function(a){return!(!a||!d.has(a,"callee"))});d.isFunction=function(a){return"[object Function]"==n.call(a)};d.isString=function(a){return"[object String]"==n.call(a)};d.isNumber=function(a){return"[object Number]"==
n.call(a)};d.isFinite=function(a){return d.isNumber(a)&&isFinite(a)};d.isNaN=function(a){return a!==a};d.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==n.call(a)};d.isDate=function(a){return"[object Date]"==n.call(a)};d.isRegExp=function(a){return"[object RegExp]"==n.call(a)};d.isNull=function(a){return null===a};d.isUndefined=function(a){return void 0===a};d.has=function(a,d){return H.call(a,d)};d.noConflict=function(){a._=b;return this};d.identity=function(a){return a};d.times=
function(a,d,b){for(var f=0;f<a;f++)d.call(b,f)};d.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};d.result=function(a,b){if(null==a)return null;var f=a[b];return d.isFunction(f)?f.call(a):f};d.mixin=function(a){m(d.functions(a),function(b){var f=d[b]=a[b];o.prototype[b]=function(){var a=g.call(arguments);k.call(a,this._wrapped);return u(f.apply(d,a),this._chain)}})};var J=0;d.uniqueId=
function(a){var d=J++;return a?a+d:d};d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var v=/.^/,q={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},w;for(w in q)q[q[w]]=w;var K=/\\|'|\r|\n|\t|\u2028|\u2029/g,L=/\\(\\|'|r|n|t|u2028|u2029)/g,x=function(a){return a.replace(L,function(a,c){return q[c]})};d.template=function(a,b,f){f=d.defaults(f||{},d.templateSettings);a="__p+='"+a.replace(K,function(a){return"\\"+q[a]}).replace(f.escape||
v,function(a,c){return"'+\n_.escape("+x(c)+")+\n'"}).replace(f.interpolate||v,function(a,c){return"'+\n("+x(c)+")+\n'"}).replace(f.evaluate||v,function(a,c){return"';\n"+x(c)+"\n;__p+='"})+"';\n";f.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",e=new Function(f.variable||"obj","_",a);if(b)return e(b,d);b=function(a){return e.call(this,a,d)};b.source="function("+(f.variable||"obj")+"){\n"+a+"}";return b};
d.chain=function(a){return d(a).chain()};var o=function(a){this._wrapped=a};d.prototype=o.prototype;var u=function(a,b){return b?d(a).chain():a};d.mixin(d);m("pop push reverse shift sort splice unshift".split(" "),function(a){var b=h[a];o.prototype[a]=function(){var d=this._wrapped;b.apply(d,arguments);var f=d.length;(a=="shift"||a=="splice")&&f===0&&delete d[0];return u(d,this._chain)}});m(["concat","join","slice"],function(a){var d=h[a];o.prototype[a]=function(){return u(d.apply(this._wrapped,arguments),
this._chain)}});o.prototype.chain=function(){this._chain=!0;return this};o.prototype.value=function(){return this._wrapped}}).call(this);(function(e){for(i in e)if(!window[i])throw"Error: ShaderGraph requires "+e[i];})({THREE:"Three.js"});window.ShaderGraph={};ShaderGraph.getShader=function(e){var a=document.getElementById(e);return a&&a.innerText||e};
(function(e){e.Block=function(a){a=a||new e.Node;this.node(a);this.children=[];this.parent=null;this.properties={};this.index=++e.Block.index;this.refresh()};e.Block.index=0;e.Block.prototype={node:function(a){return void 0!==a?(this._node=a,this):this._node},refresh:function(){this._node.owner(this);this._node.outlets(this.outlets())},fetch:function(){}};e.Block.Snippet=function(a){this.snippet=new e.Snippet(a);e.Block.call(this)};e.Block.Snippet.prototype=_.extend({},e.Block.prototype,{insert:function(a,
b,f){e.Block.Snippet.compileCall(a,b,this.node(),this.snippet,f)},fetch:function(a,b,f,e){a.include(this,b)||this.insert(a,b,e);return f.id()},outlets:function(){return e.Block.Snippet.makeOutlets(this.snippet.arguments())}});e.Block.Material=function(a,b){this.vertex=new e.Snippet(a);this.fragment=new e.Snippet(b);e.Block.call(this)};e.Block.Material.prototype=_.extend({},e.Block.prototype,{compile:function(){if(0<this.node().outputs.length)throw"Can't compile material with outputs";this.node();
var a=new e.Program;this.insert(a,"vertex",0);this.insert(a,"fragment",0);a.compile();return a},insert:function(a,b,f){e.Block.Snippet.compileCall(a,b,this.node(),this[b],f)},fetch:function(a,b,f,e){a.include(this,b)||this.insert(a,b,e);"fragment"==b&&(a.include(this,"vertex")||this.insert(a,"vertex",0));return f.id()},outlets:function(){var a=e.Block.Snippet.makeOutlets(this.vertex.arguments()),b=e.Block.Snippet.makeOutlets(this.fragment.arguments());return _.union(a,b)}});e.Block.Snippet.makeOutlets=
function(a){var b=[];_.each(a.parameters,function(a){a.meta={required:!0};a.hint=a.name.replace(/(In|Out)$/,"");a.category="parameter";b.push(a)});_.each(a.uniforms,function(a){a.meta={};a.hint=a.name.replace(/(In|Out)$/,"");a.category="uniform";a.inout=e.IN;b.push(a)});return b};e.Block.Snippet.compileCall=function(a,b,f,h,l){var g=h.arguments(),k=[];_.each(g.parameters,function(g){var h=f.get(g.name);if(g.inout==e.IN)if(h.input)h=h.input.node.owner().fetch(a,b,h.input,l+1),a.variable(b,h,g.type),
k.push(h);else throw["Missing connection on outlet for "+g.name,h.name];else g.inout==e.OUT&&(h=h.id(),a.variable(b,h,g.type),k.push(h))});var n=[];_.each(g.uniforms,function(e){var g=f.get(e.name);g.input?(g=g.input.node.owner().fetch(a,b,g.input,l+1),a.variable(b,g,e.type),k.push(g),n.push(e.name)):a.external("uniform",e.name,e.type,e.value)});g=["__",b,h.name,f.owner().index].join("");h=h.compile(g,n);a.add(b,g,k,h,l)}})(ShaderGraph);
(function(e){e.Factory=function(){this.end()};e.Factory.prototype={snippet:function(a){a=new e.Block.Snippet(ShaderGraph.getShader(a));this.append(a.node());return this},material:function(a,b){var f=new e.Block.Material(ShaderGraph.getShader(a),ShaderGraph.getShader(b));this.append(f.node());return this},append:function(a){this.graph.add(a);var b=this.stack[0];_.each(b.end,function(b){b.connect(a)});b.start.length||(b.start=[a]);b.end=[a];return this},prepend:function(a){this.graph.add(a);_.each(context.start,
function(b){a.connect(b)});context.end.length||(context.end=[a]);context.start=[a];return this},group:function(){this.stack.unshift({start:[],end:[]});return this},next:function(){this.combine().group();return this},combine:function(){if(1>=this.stack.length)throw"Popping factory stack too far.";var a=this.stack.shift(),b=this.stack[0];b.start=b.start.concat(a.start);b.end=b.end.concat(a.end)},end:function(){var a=this.graph;this.graph=new e.Graph;this.stack=[];this.group();return a}}})(ShaderGraph);
(function(e){e.Program=function(){this.calls={vertex:{},fragment:{}};this.variables={vertex:{},fragment:{}};this.externals={};this.compiled=!1;this.uniforms={};this.fragmentShader=this.vertexShader="";this.includes={vertex:[],fragment:[]}};e.Program.types={f:"float",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4",t:"sampler2D"};e.Program.prototype={include:function(a,b){if(0<=this.includes[b].indexOf(a))return!0;this.includes[b].push(a);return!1},external:function(a,b,f,e){this.externals[b]={category:a,
name:b,type:f,value:e}},variable:function(a,b,f){this.variables[a][b]={name:b,type:f}},add:function(a,b,f,e,l){var g=this.calls[a][b];g?g.priority=Math.min(g.priority,l):this.calls[a][b]={name:b,args:f,code:e,priority:l}},compile:function(){_.each(this.externals,function(a){"uniform"==a.category&&(this.uniforms[a.name]={type:a.type,value:a.value})}.bind(this));_.each(["vertex","fragment"],function(a){var b=_.toArray(this.calls[a]),f=[],h=["void main() {"];_.each(this.variables[a],function(a){h.push([e.Program.types[a.type],
a.name,";"].join(" "))});b.sort(function(a,b){return b.priority-a.priority});_.each(b,function(a){f.push(a.code);h.push([a.name,"(",a.args.join(","),");"].join(""))});h.push("}");this[a+"Shader"]=[f.join("\n"),h.join("\n")].join("\n")}.bind(this));this.compiled=!0},material:function(){if(!this.compiled)throw"Fetching material from uncompiled program.";return new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertex,fragmentShader:this.fragment})}}})(ShaderGraph);
(function(e){e.Snippet=function(a){this.code=a;this.attributes=[];this.uniforms=[];this.varyings=[];this.parameters=[];this.body=this.signature="";this.parseCode(a)};e.Snippet.types={"float":"f",vec2:"v2",vec3:"v3",vec4:"v4",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"};e.Snippet.defaults={"float":0,vec2:new THREE.Vector3,vec3:new THREE.Vector3,vec4:new THREE.Vector4,mat4:new THREE.Matrix4,sampler2D:0,samplerCube:0};e.Snippet.prototype={compile:function(a,b){var f=this.signature.slice(),e=[],
b=b||[];_.each(this.uniforms,function(a){0<=b.indexOf(a.name)?f.push(a.signature):e.push(["uniform",a.signature].join(" "))});_.each(this.attributes,function(a){e.push(["attribute",a.signature].join(" "))});_.each(this.varyings,function(a){e.push(["varying",a.signature].join(" "))});var l=this.body.replace(/\s*void\s+([A-Za-z0-9]+)\s*\([^\)]*\)/g,["void",a+"(",f.join(", "),")"].join(" "));e.push(l);return e.join(";\n")},arguments:function(){return{uniforms:this.uniforms,parameters:this.parameters}},
type:function(a,b){a=(e.Snippet.types[a]||"f")+(b?"v":"");return"fv"==a?"fv1":a},parseAttribute:function(a){var b=a[1];this.attributes.push({name:a[3],type:this.type(a[2],a[4]),signature:b})},parseUniform:function(a){var b=a[1],f=a[2];this.uniforms.push({name:a[3],type:this.type(f,a[4]),value:e.Snippet.defaults[f]||0,signature:b})},parseVarying:function(a){var b=a[1];this.varyings.push({name:a[3],type:this.type(a[2],a[4]),signature:b})},parseSignature:function(a){this.name=a[1];var b=a[2].replace(/^\s*$/g,
"");0==b.length?this.signature=[]:(arguments=this.signature=b.split(","),_.each(arguments,function(a){var a=/((?:(in|out|inout)\s+)?([A-Za-z0-9]+)\s+([A-Za-z0-9_]+)\s*(?:\[([^\]]+)\])?)(?:$|(?=;))/.exec(a),b=a[1];this.parameters.push({inout:{"in":e.IN,out:e.OUT,inout:e.INOUT}[a[2]||"in"],name:a[4],type:this.type(a[3],a[5]),signature:b})}.bind(this)))},parseCode:function(a){function b(a,b){if(!a.global)throw"Can't findAll non-global regexp";for(var f,e=[];f=a.exec(b);)e.push(f);return e}var a=a.replace(/\r\n?/g,
"\n").replace(/\/\/[^\n]*\n/g," ").replace(/\/\*(.|\n)*?\*\//g," "),f=b(/(?:^|;)\s*attribute\s+(([A-Za-z0-9]+)\s+([A-Za-z0-9_]+)\s*(?:\[([^\]]+)\])?)(?:$|(?=;))/g,a),e=b(/(?:^|;)\s*uniform\s+(([A-Za-z0-9]+)\s+([A-Za-z0-9_]+)\s*(?:\[([^\]]+)\])?)(?:$|(?=;))/g,a),l=b(/(?:^|;)\s*varying\s+(([A-Za-z0-9]+)\s+([[A-Za-z0-9_]+)\s*(?:\[([^\]]+)\])?)(?:$|(?=;))/g,a),g=b(/(?:^|;)\s*void\s+([A-Za-z0-9]+)\s*\(([^\)]*)\)\s*{/g,a);if(!g[0])throw"Could not parse shader snippet. Must contain a void-returning function with in/outs: "+
a;var k=a;_.each({parseAttribute:f,parseUniform:e,parseVarying:l},function(a,b){_.each(a,function(a){this[b](a);k=k.replace(a[0],"")}.bind(this))}.bind(this));k=k.replace(/^\s*;/,"");this.parseSignature(g[0]);this.body=k}}})(ShaderGraph);
(function(e){e.Graph=function(a,b){this.parent=b||null;this.nodes=[];a&&this.add(a)};e.Graph.prototype={iterate:function(a){_.each(this.nodes,function(b){a(b,b._owner)})},exposed:function(){var a=[];this.iterate(function(b){_.each(b.outlets(),function(b){b.exposed&&a.push(b)})});return a},inputs:function(){var a=[];this.iterate(function(b){_.each(b.inputs,function(b){null==b.input&&a.push(b)})});return a},outputs:function(){var a=[];this.iterate(function(b){_.each(b.outputs,function(b){0==b.output.length&&
a.push(b)})});return a},tail:function(){return this.nodes[this.nodes.length-1]},add:function(a){if(a.constructor==Array)return _.each(a,function(a){this.add(a)}.bind(this));if(a.graph)throw"Adding node to two graphs at once";a.link(this);this.nodes.push(a)},remove:function(a,b){var f=this;if(a.constructor==Array)return _.each(a,function(a){f.remove(a)});if(a.graph!=this)throw"Removing node from wrong graph.";b||a.disconnect();this.nodes.splice(this.nodes.indexOf(a),1)}};e.IN=0;e.OUT=1;e.INOUT=2})(ShaderGraph);
(function(e){e.Node=function(a,b){this.graph=null;this.inputs=[];this.outputs=[];this._outlets={};this.owner(a);this.outlets(b)};e.Node.prototype={owner:function(a){return void 0!==a?(this._owner=a,this):this._owner},link:function(a){this.graph=a},getIn:function(a){return this.get(a,e.IN)},getOut:function(a){return this.get(a,e.OUT)},get:function(a,b){return void 0===b?this.get(a,e.IN)||this.get(a,e.OUT):this._outlets[[a,b].join("-")]},key:function(a){return[a.name,a.inout].join("-")},outlets:function(a){if(void 0!==
a){var b={};_.each(a,function(a){b[[a.name,a.inout,a.type].join("-")]=!0}.bind(this));_.each(this._outlets,function(a){b[[a.name,a.inout,a.type].join("-")]||this.remove(a)}.bind(this));_.each(a,function(a){var b=this.get(a.name,a.inout);b?b.morph(a):(a=new e.Outlet(a),this.add(a))}.bind(this));return this}return this._outlets},add:function(a){var b=this.key(a);outlets=this._outlets;_in=this.inputs;_out=this.outputs;if(a.node)throw"Adding outlet to two nodes at once.";if(outlets[b])throw"Adding two identical outlets to same node.";
a.link(this);outlets[b]=a;(a.inout==e.IN?_in:_out).push(a);return this},remove:function(a){var b=this._outlets,f=this.key(a),h=a.inout==e.IN?this.inputs:this.outputs;if(a.node!=this)throw"Removing outlet from wrong node.";a.disconnect();a.link(null);delete b[f];h.splice(h.indexOf(a),1);return this},connect:function(a){var b={},e={},h;h={};_.each(a.inputs,function(a){var g=a.type,k=[g,a.hint].join("-"),n=h[g]=(h[g]||0)+1,g=[g,n].join("-");e[k]=a;b[g]=a});h={};_.each(this.outputs,function(a){var g=
a.type,k=[g,a.hint].join("-");e[k]?e[k].connect(a):(k=h[g]=(h[g]||0)+1,g=[g,k].join("-"),b[g]&&b[g].connect(a))});return this},disconnect:function(){_.each(this.inputs,function(a){a.disconnect()});_.each(this.outputs,function(a){a.disconnect()});return this}}})(ShaderGraph);
(function(e){e.Outlets=0;e.Outlet=function(a,b,f,h,l,g,k){if("object"==typeof a)return new e.Outlet(a.inout,a.name,a.hint,a.type,a.category,a.exposed);this.node=null;this.inout=a;this.name=b;this.hint=f||b;this.type=h;this.category=l;this.exposed=!!g;this.meta=k||{};this.index=++e.Outlets;this.input=null;this.output=[]};e.Outlet.prototype={id:function(){return["",this.name,this.index].join("__")},expose:function(a){this.exposed=a},morph:function(a){this.inout=a.inout;this.name=a.name;this.type=a.type;
this.category=a.category;this.exposed=a.exposed;this.meta=a.meta||{}},connect:function(a){if(this.inout==e.IN&&a.inout==e.OUT)return a.connect(this);if(this.inout!=e.OUT||a.inout!=e.IN)throw console.log(this,a),"Can't connect out/out or in/in outlets.";a.input!=this&&(a.disconnect(),a.input=this,this.output.push(a))},disconnect:function(a){if(this.inout==e.IN)this.input&&this.input.disconnect(this);else if(a){var b=this.output.indexOf(a);0<=b&&(this.output.splice(b,1),a.input=null)}else _.each(this.output,
function(a){a.input=null}),this.output=[]},link:function(a){this.node=a}}})(ShaderGraph);
